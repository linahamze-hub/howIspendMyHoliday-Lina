<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø§Ù„Ù†Øµ Ø§Ù„Ø­ÙŠ â€“ ÙƒÙŠÙ Ø£Ù‚Ø¶ÙŠ Ø¹Ø·Ù„ØªÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  body{font-family:'Almarai',sans-serif;background:#E7F7F4;margin:0;padding:0;direction:rtl}
  .app-container{max-width:1100px;margin:32px auto;padding:0 16px}
  .app-layout{display:flex;flex-wrap:wrap;gap:16px}
  .card{background:#fff;border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.1);padding:20px 22px}
  .text-card{flex:1.6;min-width:300px}
  .info-card{flex:1;min-width:280px}
  h1{font-size:26px;margin-bottom:18px;color:#2F4858}
  .paragraph{line-height:1.9;font-size:17px;margin-bottom:12px}
  .word{cursor:pointer;padding:2px 4px;border-radius:6px;transition:background .15s ease}
  .word:hover{background:#E0F2FF}
  .has-vocab{background:#EEF2FF;box-shadow:0 0 0 1px #A5B4FC}
  .verb-word{color:#1D4ED8;font-weight:700}
  .info-title{font-size:18px;font-weight:700;margin-bottom:10px;color:#2F4858}
  .info-word{font-size:22px;font-weight:800;margin-bottom:10px}
  .info-label{font-size:13px;margin-bottom:4px;font-weight:600;color:#6b7280}
  .info-value{font-size:15px;margin-bottom:10px}
  .image-card{margin-top:12px;background:#F9FAFB;padding:10px;border-radius:12px;border:1px solid #E5E7EB;text-align:center}
  .word-image{max-width:100%;max-height:150px;object-fit:contain;border-radius:10px;border:1px solid #e5e7eb;margin-bottom:8px}
  .popup-card{position:absolute;background:#fff;border-radius:12px;padding:10px;box-shadow:0 10px 26px rgba(0,0,0,.25);max-width:260px;z-index:9999}
  .popup-image{max-width:100%;max-height:130px;object-fit:contain;border-radius:10px;margin-bottom:8px;border:1px solid #eee}
  .speak-btn{display:inline-block;padding:6px 14px;border-radius:999px;background:#1D4ED8;color:#fff;cursor:pointer;font-size:14px;margin-bottom:8px;text-align:center;user-select:none}
  .speak-btn[aria-disabled="true"]{opacity:.5;cursor:not-allowed}
  .definition-card{margin-top:8px;padding:8px 10px;border-radius:10px;background:#F3F4FF;border:1px solid #E5E7EB}
  .definition-label{font-size:13px;font-weight:600;color:#4b5563;margin-bottom:4px}
  .definition-value{font-size:14px;color:#111827}
  .transliteration{font-size:14px;color:#6b7280;margin-bottom:10px;font-style:italic}
</style>
</head>

<body>
<div class="app-container">
  <h1>ÙƒÙŠÙ Ø£Ù‚Ø¶ÙŠ Ø¹Ø·Ù„ØªÙŠ â€“ Ø§Ù„Ù†Øµ Ø§Ù„Ø­ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h1>

  <div class="app-layout">
    <div class="card text-card">
      <div id="textContainer"></div>
    </div>

    <div class="card info-card">
      <div class="info-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø©</div>
      <div id="infoContent">Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ù†Øµ.</div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ğŸ”§ Helpful: show any JS error on screen
  window.addEventListener("error", (e) => {
    console.error(e.error || e.message);
    const box = document.getElementById("infoContent");
    if (box) box.innerHTML = `<div style="color:#b91c1c;font-weight:700">âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯</div><div style="font-size:13px;margin-top:6px">${(e.error && e.error.message) ? e.error.message : e.message}</div>`;
  });

  const RAW_BASE = "https://raw.githubusercontent.com/linahamze-hub/howIspendMyHoliday-Lina/main/";
  const rawUrl = (fileName) => fileName ? encodeURI(RAW_BASE + fileName) : "";

  const textParagraphs = [
    "ÙƒÙŠÙ Ø£Ù‚Ø¶ÙŠ Ø¹Ø·Ù„ØªÙŠ",
    "Ù‡Ù„ ØªØ¹Ø±ÙÙˆÙ† Ø¬Ø²ÙŠØ±Ø© ÙƒØ±ÙŠØª ÙÙŠ Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ØŸ",
    "Ø¬Ø²ÙŠØ±Ø© ÙƒØ±ÙŠØª Ù…ÙƒØ§Ù† Ø±Ø§Ø¦Ø¹ Ù„Ù„Ø¥Ø¬Ø§Ø²Ø© ÙÙŠ ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„. Ø£Ù†Ø§ ÙˆØ£Ø³Ø±ØªÙŠ Ù†Ø­Ø¨ Ù‚Ø¶Ø§Ø¡ Ø¹Ø·Ù„ØªÙ†Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø²ÙŠØ±Ø© Ù„Ø£Ù†Ù‡Ø§ Ø¬Ù…ÙŠÙ„Ø© ÙˆÙ„ÙŠØ³Øª Ø¨Ø¹ÙŠØ¯Ø©.",
    "Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø°Ù‡Ø¨ ÙÙŠ Ø§Ù„ØµÙŠÙØŒ Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø³Ø¨Ø§Ø­Ø© ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ. ÙˆÙ†Ø³ØªØ·ÙŠØ¹ Ø£ÙŠØ¶Ù‹Ø§ Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø·Ø¦ ÙˆØ§Ù„Ø¬Ù„ÙˆØ³ ÙˆØ§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ø´Ù…Ø³.",
    "ÙˆØ§Ù„Ø¯ØªÙŠ ØªÙ‚Ø¶ÙŠ ÙˆÙ‚ØªÙ‡Ø§ Ø¹Ø§Ø¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£Ùˆ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ØŒ ÙˆØ£Ø­ÙŠØ§Ù†Ù‹Ø§ ØªØ°Ù‡Ø¨ Ù…Ø¹ ØµØ¯ÙŠÙ‚Ø§ØªÙ‡Ø§ Ù„Ù„Ø±Ù‚Øµ Ø£Ùˆ Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙŠÙˆØºØ§.",
    "ÙˆÙˆØ§Ù„Ø¯ÙŠ ÙŠØ­Ø¨ Ø§Ù„Ù†ÙˆÙ… ÙˆÙŠØ­Ø¨ Ø£ÙŠØ¶Ù‹Ø§ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ÙŠØŒ ÙˆÙ„Ù‡Ø°Ø§ ÙŠØ°Ù‡Ø¨ Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø¥Ù„Ù‰ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø·Ø¨Ø®.",
    "Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø°Ù‡Ø¨ ÙÙŠ Ø§Ù„Ø´ØªØ§Ø¡ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø±ÙƒÙˆØ¨ Ø§Ù„Ø®ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´ÙŠ Ø¨ÙŠÙ† Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ† ÙÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù„ØŒ ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ø³Ø¨Ø§Ø­Ø© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø¨Ø±Ø¯.",
    "Ø£Ù†Ø§ Ø£Ø­Ø¨ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙ„Ø°Ù„Ùƒ Ø¹Ù†Ø¯ÙŠ ØµÙˆØ± ÙƒØ«ÙŠØ±Ø© Ù„Ù„Ù‚Ø±Ù‰ Ø§Ù„ØµØºÙŠØ±Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©ØŒ ÙˆÙ„Ù„Ø¨Ø­Ø±ØŒ ÙˆÙ„Ù„Ù…Ø§Ø¹Ø²ØŒ ÙˆÙ„Ù„Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©."
  ];

  // âœ… FIX: add "ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ" as a recognized phrase (same target as "ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ")
  const PHRASES = ["ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ","ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ","Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©","Ø±ÙƒÙˆØ¨ Ø§Ù„Ø®ÙŠÙ„","Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†"];

  const vocab = {
    "Ø¬Ø²ÙŠØ±Ø©":   { type:"vocab", base:"Ø¬ÙØ²ÙÙŠØ±ÙØ©ÙŒ", letters:"Ø¬ Ù€ Ø² Ù€ ÙŠ Ù€ Ø± Ù€ Ø©", meaning:"island", transliteration:"jazÄ«ra",
                audioFile:"Ø¬Ø²ÙŠØ±Ø©.mp3", imageFile:"Ø¬Ø²ÙŠØ±Ø©.jpg" },

    "Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©": { type:"vocab", base:"Ø§Ù„Ø¥ÙØ¬ÙØ§Ø²ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¥ Ù€ Ø¬ Ù€ Ø§ Ù€ Ø² Ù€ Ø©", meaning:"vacation", transliteration:"al-ijÄza",
                audioFile:"Ø§Ù„Ø§Ù•Ø¬Ø§Ø²Ø©.mp3", imageFile:"Ø§Ù„Ø§Ù•Ø¬Ø§Ø²Ø©.jpg" },

    "Ø§Ù„ÙØµÙˆÙ„":  { type:"vocab", base:"Ø§Ù„ÙÙØµÙÙˆÙ„Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ù Ù€ Øµ Ù€ Ùˆ Ù€ Ù„", meaning:"seasons", transliteration:"al-fuá¹£Å«l",
                audioFile:"Ø§Ù„ÙØµÙˆÙ„.mp3", imageFile:"Ø§Ù„ÙØµÙˆÙ„.jpg" },

    "Ø£Ù‚Ø¶ÙŠ":    { type:"verb", base:"Ø£ÙÙ‚Ù’Ø¶ÙÙŠ", letters:"Ø£ Ù€ Ù‚ Ù€ Ø¶ Ù€ ÙŠ", meaning:"I spend (time)", transliteration:"aqá¸Ä«",
                audioFile:"Ø§Ù”Ù‚Ø¶ÙŠ.mp3", imageFile:"" },

    "Ø¬Ù…ÙŠÙ„Ø©":   { type:"vocab", base:"Ø¬ÙÙ…ÙÙŠÙ„ÙØ©ÙŒ", letters:"Ø¬ Ù€ Ù… Ù€ ÙŠ Ù€ Ù„ Ù€ Ø©", meaning:"beautiful (f.)", transliteration:"jamÄ«la",
                audioFile:"Ø¬Ù…ÙŠÙ„Ø©.mp3", imageFile:"Ø¬Ù…ÙŠÙ„Ø©.jpg" },

    "ÙˆÙ‚Øª":     { type:"vocab", base:"ÙˆÙÙ‚Ù’ØªÙŒ", letters:"Ùˆ Ù€ Ù‚ Ù€ Øª", meaning:"time", transliteration:"waqt",
                audioFile:"ÙˆÙ‚Øª.mp3", imageFile:"ÙˆÙ‚Øª.jpg" },

    "Ø¨Ø¹ÙŠØ¯Ø©":   { type:"vocab", base:"Ø¨ÙØ¹ÙÙŠØ¯ÙØ©ÙŒ", letters:"Ø¨ Ù€ Ø¹ Ù€ ÙŠ Ù€ Ø¯ Ù€ Ø©", meaning:"far (f.)", transliteration:"baÊ¿Ä«da",
                audioFile:"Ø¨Ø¹ÙŠØ¯Ø©.mp3", imageFile:"" },

    "Ø§Ù„ØµÙŠÙ":   { type:"vocab", base:"Ø§Ù„ØµÙ‘ÙÙŠÙ’ÙÙ", letters:"Ø§ Ù€ Ù„ Ù€ Øµ Ù€ ÙŠ Ù€ Ù", meaning:"summer", transliteration:"aá¹£-á¹£ayf",
                audioFile:"Ø§Ù„ØµÙŠÙ.mp3", imageFile:"Ø§Ù„ØµÙŠÙ.jpg" },

    "Ù†Ø³ØªØ·ÙŠØ¹":  { type:"verb", base:"Ù†ÙØ³Ù’ØªÙØ·ÙÙŠØ¹Ù", letters:"Ù† Ù€ Ø³ Ù€ Øª Ù€ Ø· Ù€ ÙŠ Ù€ Ø¹", meaning:"we can", transliteration:"nastaá¹­Ä«Ê¿",
                audioFile:"Ù†Ø³ØªØ·ÙŠØ¹.mp3", imageFile:"" },

    "Ø§Ù„Ø³Ø¨Ø§Ø­Ø©": { type:"vocab", base:"Ø§Ù„Ø³Ù‘ÙØ¨ÙØ§Ø­ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø³ Ù€ Ø¨ Ù€ Ø§ Ù€ Ø­ Ù€ Ø©", meaning:"swimming", transliteration:"as-sibÄá¸¥a",
                audioFile:"Ø§Ù„Ø³Ø¨Ø§Ø­Ø©.mp3", imageFile:"Ø§Ù„Ø³Ø¨Ø§Ø­Ø©.jpg" },

    // Keep canonical phrase
    "ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ":{ type:"vocab", base:"ØµÙÙŠÙ’Ø¯Ù Ø§Ù„Ø³Ù‘ÙÙ…ÙÙƒÙ", letters:"Øµ Ù€ ÙŠ Ù€ Ø¯ / Ø§ Ù€ Ù„ Ù€ Ø³ Ù€ Ù… Ù€ Ùƒ", meaning:"fishing", transliteration:"á¹£ayd as-samak",
                audioFile:"ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ.mp3", imageFile:"ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ.jpg" },

    "Ø§Ù„Ù„Ø¹Ø¨":   { type:"vocab", base:"Ø§Ù„Ù„Ù‘ÙØ¹ÙØ¨Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ù„ Ù€ Ø¹ Ù€ Ø¨", meaning:"playing", transliteration:"al-laÊ¿b",
                audioFile:"Ù„Ù„Ø¹Ø¨.mp3", imageFile:"Ø§Ù„Ù„Ø¹Ø¨.jpg" },

    "Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©":{ type:"vocab", base:"Ø§Ù„ÙƒÙØ±ÙØ©Ù Ø§Ù„Ø·Ù‘ÙØ§Ø¦ÙØ±ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ùƒ Ù€ Ø± Ù€ Ø© / Ø§ Ù€ Ù„ Ù€ Ø· Ù€ Ø§ Ù€ Ø¦ Ù€ Ø± Ù€ Ø©", meaning:"volleyball", transliteration:"al-kura aá¹­-á¹­ÄÊ¾ira",
                audioFile:"Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø·Ø§ÙŠÙ”Ø±Ø©.mp3", imageFile:"Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©.jpg" },

    "Ø§Ù„Ø´Ø§Ø·Ø¦":  { type:"vocab", base:"Ø§Ù„Ø´Ù‘ÙØ§Ø·ÙØ¦Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø´ Ù€ Ø§ Ù€ Ø· Ù€ Ø¦", meaning:"beach", transliteration:"ash-shÄá¹­iÊ¾",
                audioFile:"Ø´Ø§Ø·ÙŠÙ”.mp3", imageFile:"Ø§Ù„Ø´Ø§Ø·Ø¦.jpg" },

    "Ø§Ù„Ø¬Ù„ÙˆØ³":  { type:"vocab", base:"Ø§Ù„Ø¬ÙÙ„ÙÙˆØ³Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¬ Ù€ Ù„ Ù€ Ùˆ Ù€ Ø³", meaning:"sitting", transliteration:"al-julÅ«s",
                audioFile:"Ø§Ù„Ø¬Ù„ÙˆØ³.mp3", imageFile:"Ù†Ø¬Ù„Ø³.jpg" },

    "Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹":{ type:"vocab", base:"Ø§Ù„Ø§Ø³Ù’ØªÙÙ…Ù’ØªÙØ§Ø¹Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø§ Ù€ Ø³ Ù€ Øª Ù€ Ù… Ù€ Øª Ù€ Ø§ Ù€ Ø¹", meaning:"enjoying", transliteration:"al-istimtÄÊ¿",
                audioFile:"Ø§Ù”Ø³ØªÙ…ØªØ¹.mp3", imageFile:"" },

    "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©": { type:"vocab", base:"Ø§Ù„Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ù‚ Ù€ Ø± Ù€ Ø§ Ù€ Ø¡ Ù€ Ø©", meaning:"reading", transliteration:"al-qirÄÊ¾a",
                audioFile:"Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.mp3", imageFile:"Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.jpg" },

    "Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰":{ type:"vocab", base:"Ø§Ù„Ù…ÙÙˆØ³ÙÙŠÙ‚ÙÙ‰", letters:"Ø§ Ù€ Ù„ Ù€ Ù… Ù€ Ùˆ Ù€ Ø³ Ù€ ÙŠ Ù€ Ù‚ Ù€ Ù‰", meaning:"music", transliteration:"al-mÅ«sÄ«qÄ",
                audioFile:"Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰.mp3", imageFile:"Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰.jpg" },

    "Ø§Ù„Ø±Ù‚Øµ":   { type:"vocab", base:"Ø§Ù„Ø±Ù‘ÙÙ‚Ù’ØµÙ", letters:"Ø§ Ù€ Ù„ Ù€ Ø± Ù€ Ù‚ Ù€ Øµ", meaning:"dancing", transliteration:"ar-raqá¹£",
                audioFile:"Ø§Ù„Ø±Ù‚Øµ.mp3", imageFile:"Ù„Ø±Ù‚Øµ.jpg" },

    "Ø§Ù„ÙŠÙˆØºØ§":  { type:"vocab", base:"Ø§Ù„Ù’ÙŠÙÙˆØºÙØ§", letters:"Ø§ Ù€ Ù„ Ù€ ÙŠ Ù€ Ùˆ Ù€ Øº Ù€ Ø§", meaning:"yoga", transliteration:"al-yÅ«ghÄ",
                audioFile:"Ø§Ù„ÙŠÙˆØºØ§.mp3", imageFile:"Ø§Ù„ÙŠÙˆØºØ§.jpg" },

    "ÙŠØ­Ø¨":     { type:"verb", base:"ÙŠÙØ­ÙØ¨Ù‘Ù", letters:"ÙŠ Ù€ Ø­ Ù€ Ø¨", meaning:"likes/loves", transliteration:"yuá¸¥ibb",
                audioFile:"ÙŠØ­Ø¨.mp3", imageFile:"ÙŠØ­Ø¨.jpg" },

    "Ø§Ù„Ù†ÙˆÙ…":   { type:"vocab", base:"Ø§Ù„Ù†Ù‘ÙÙˆÙ’Ù…Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ù† Ù€ Ùˆ Ù€ Ù…", meaning:"sleep", transliteration:"an-nawm",
                audioFile:"Ø§Ù„Ù†ÙˆÙ….mp3", imageFile:"Ø§Ù„Ù†ÙˆÙ….jpg" },

    "Ø§Ù„Ø·Ø¹Ø§Ù…":  { type:"vocab", base:"Ø§Ù„Ø·Ù‘ÙØ¹ÙØ§Ù…Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø· Ù€ Ø¹ Ù€ Ø§ Ù€ Ù…", meaning:"food", transliteration:"aá¹­-á¹­aÊ¿Äm",
                audioFile:"Ø§Ù„Ø·Ø¹Ø§Ù….mp3", imageFile:"Ø§Ù„Ø·Ø¹Ø§Ù….jpg" },

    "Ø¯Ø±ÙˆØ³":    { type:"vocab", base:"Ø¯ÙØ±ÙÙˆØ³ÙŒ", letters:"Ø¯ Ù€ Ø± Ù€ Ùˆ Ù€ Ø³", meaning:"lessons", transliteration:"durÅ«s",
                audioFile:"Ø¯Ø±ÙˆØ³.mp3", imageFile:"Ø¯Ø±ÙˆØ³.jpg" },

    "Ø§Ù„Ø·Ø¨Ø®":   { type:"vocab", base:"Ø§Ù„Ø·Ù‘ÙØ¨Ù’Ø®Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø· Ù€ Ø¨ Ù€ Ø®", meaning:"cooking", transliteration:"aá¹­-á¹­abkh",
                audioFile:"Ø§Ù„Ø·Ø¨Ø®.mp3", imageFile:"Ø§Ù„Ø·Ø¨Ø®.jpg" },

    "Ø§Ù„Ø´ØªØ§Ø¡":  { type:"vocab", base:"Ø§Ù„Ø´Ù‘ÙØªÙØ§Ø¡Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø´ Ù€ Øª Ù€ Ø§ Ù€ Ø¡", meaning:"winter", transliteration:"ash-shitÄÊ¾",
                audioFile:"Ø§Ù„Ø´ØªØ§Ø¡.mp3", imageFile:"Ø§Ù„Ø´ØªØ§Ø¡.jpg" },

    "ÙŠÙ…ÙƒÙ†Ù†Ø§":  { type:"verb", base:"ÙŠÙÙ…Ù’ÙƒÙÙ†ÙÙ†ÙØ§", letters:"ÙŠ Ù€ Ù… Ù€ Ùƒ Ù€ Ù† Ù€ Ù† Ù€ Ø§", meaning:"we can", transliteration:"yumkinunÄ",
                audioFile:"ÙŠÙ…ÙƒÙ†Ù†Ø§.mp3", imageFile:"" },

    "Ø±ÙƒÙˆØ¨ Ø§Ù„Ø®ÙŠÙ„":{ type:"vocab", base:"Ø±ÙÙƒÙÙˆØ¨Ù Ø§Ù„Ø®ÙÙŠÙ’Ù„Ù", letters:"Ø± Ù€ Ùƒ Ù€ Ùˆ Ù€ Ø¨ / Ø§ Ù€ Ù„ Ù€ Ø® Ù€ ÙŠ Ù€ Ù„", meaning:"horse riding", transliteration:"rukÅ«b al-khayl",
                audioFile:"Ø±ÙƒÙˆØ¨ Ø§Ù„Ø®ÙŠÙ„.mp3", imageFile:"Ø±ÙƒÙˆØ¨ Ø§Ù„Ø®ÙŠÙ„.jpg" },

    "Ø§Ù„Ù…Ø´ÙŠ":   { type:"vocab", base:"Ø§Ù„Ù…ÙØ´Ù’ÙŠÙ", letters:"Ø§ Ù€ Ù„ Ù€ Ù… Ù€ Ø´ Ù€ ÙŠ", meaning:"walking", transliteration:"al-mashy",
                audioFile:"Ø§Ù„Ù…Ø´ÙŠ.mp3", imageFile:"Ø§Ù„Ù…Ø´ÙŠ.jpg" },

    "Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†":{ type:"vocab", base:"Ù…ÙØ²ÙØ§Ø±ÙØ¹Ù Ø§Ù„Ø²Ù‘ÙÙŠÙ’ØªÙÙˆÙ†Ù", letters:"Ù… Ù€ Ø² Ù€ Ø§ Ù€ Ø± Ù€ Ø¹ / Ø§ Ù€ Ù„ Ù€ Ø² Ù€ ÙŠ Ù€ Øª Ù€ Ùˆ Ù€ Ù†", meaning:"olive farms", transliteration:"mazÄriÊ¿ az-zaytÅ«n",
                audioFile:"Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†.mp3", imageFile:"Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†.jpg" },

    "Ø§Ù„Ø¬Ø¨Ø§Ù„":  { type:"vocab", base:"Ø§Ù„Ø¬ÙØ¨ÙØ§Ù„Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¬ Ù€ Ø¨ Ù€ Ø§ Ù€ Ù„", meaning:"mountains", transliteration:"al-jibÄl",
                audioFile:"Ø§Ù„Ø¬Ø¨Ø§Ù„.mp3", imageFile:"Ø§Ù„Ø¬Ø¨Ø§Ù„.jpg" },

    "Ø§Ù„Ø¨Ø±Ø¯":   { type:"vocab", base:"Ø§Ù„Ø¨ÙØ±Ù’Ø¯Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¨ Ù€ Ø± Ù€ Ø¯", meaning:"cold", transliteration:"al-bard",
                audioFile:"Ø§Ù„Ø¨Ø±Ø¯.mp3", imageFile:"Ø§Ù„Ø¨Ø±Ø¯.jpg" },

    "Ø§Ù„ØªØµÙˆÙŠØ±": { type:"vocab", base:"Ø§Ù„ØªÙ‘ÙØµÙ’ÙˆÙÙŠØ±Ù", letters:"Ø§ Ù€ Ù„ Ù€ Øª Ù€ Øµ Ù€ Ùˆ Ù€ ÙŠ Ù€ Ø±", meaning:"photography", transliteration:"at-taá¹£wÄ«r",
                audioFile:"Ø§Ù„ØªØµÙˆÙŠØ±.mp3", imageFile:"Ø§Ù„ØªØµÙˆÙŠØ±.jpg" },

    "ØµÙˆØ±":     { type:"vocab", base:"ØµÙÙˆÙØ±ÙŒ", letters:"Øµ Ù€ Ùˆ Ù€ Ø±", meaning:"photos", transliteration:"á¹£uwar",
                audioFile:"ØµÙˆØ±.mp3", imageFile:"ØµÙˆØ±.jpg" },

    "Ø§Ù„Ø¨Ø­Ø±":   { type:"vocab", base:"Ø§Ù„Ø¨ÙØ­Ù’Ø±Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¨ Ù€ Ø­ Ù€ Ø±", meaning:"sea", transliteration:"al-baá¸¥r",
                audioFile:"Ø§Ù„Ø¨Ø­Ø±.mp3", imageFile:"Ø¨Ø­Ø±.jpg" },

    "Ø§Ù„Ù…Ø§Ø¹Ø²":  { type:"vocab", base:"Ø§Ù„Ù…ÙØ§Ø¹ÙØ²Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ù… Ù€ Ø§ Ù€ Ø¹ Ù€ Ø²", meaning:"goats", transliteration:"al-mÄÊ¿iz",
                audioFile:"Ø§Ù„Ù…Ø§Ø¹Ø².mp3", imageFile:"Ù„Ù„Ù…Ø§Ø¹Ø².jpg" },

    "Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©": { type:"vocab", base:"Ø§Ù„Ø·Ù‘ÙØ¨ÙÙŠØ¹ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø· Ù€ Ø¨ Ù€ ÙŠ Ù€ Ø¹ Ù€ Ø©", meaning:"nature", transliteration:"aá¹­-á¹­abÄ«Ê¿a",
                audioFile:"Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©.mp3", imageFile:"Ù„Ù„Ø·Ø¨ÙŠØ¹Ø©.jpg" },

    "Ù‚Ø±ÙŠØ©":    { type:"vocab", base:"Ù‚ÙØ±Ù’ÙŠÙØ©ÙŒ", letters:"Ù‚ Ù€ Ø± Ù€ ÙŠ Ù€ Ø©", meaning:"village", transliteration:"qarya",
                audioFile:"Ù‚Ø±ÙŠØ©.mp3", imageFile:"Ù‚Ø±ÙŠØ©.jpg" },

    "Ø§Ù„Ø¹Ø·Ù„Ø©":  { type:"vocab", base:"Ø§Ù„Ø¹ÙØ·Ù’Ù„ÙØ©Ù", letters:"Ø§ Ù€ Ù„ Ù€ Ø¹ Ù€ Ø· Ù€ Ù„ Ù€ Ø©", meaning:"holiday", transliteration:"al-Ê¿uá¹­la",
                audioFile:"Ø§Ù„Ø¹Ø·Ù„Ø©.mp3", imageFile:"Ø¹Ø·Ù„ØªÙ†Ø§.jpg" },

    "ØªØ³ØªÙ…Ø¹":   { type:"verb", base:"ØªÙØ³Ù’ØªÙÙ…ÙØ¹Ù", letters:"Øª Ù€ Ø³ Ù€ Øª Ù€ Ù… Ù€ Ø¹", meaning:"she listens", transliteration:"tastamiÊ¿",
                audioFile:"ØªØ³ØªÙ…Ø¹.mp3", imageFile:"" },
  };

  // âœ… KEY FIX: "ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ" points to same data as "ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ"
  vocab["ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ"] = vocab["ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ"];

  // Build URLs
  Object.keys(vocab).forEach(k => {
    vocab[k].audio = vocab[k].audioFile ? rawUrl(vocab[k].audioFile) : "";
    vocab[k].image = vocab[k].imageFile ? rawUrl(vocab[k].imageFile) : "";
  });

  // Attached forms
  vocab["Ø¹Ø·Ù„ØªÙŠ"] = vocab["Ø§Ù„Ø¹Ø·Ù„Ø©"];
  vocab["Ø¹Ø·Ù„ØªÙ†Ø§"] = vocab["Ø§Ù„Ø¹Ø·Ù„Ø©"];
  vocab["Ù„Ù„Ø¥Ø¬Ø§Ø²Ø©"] = vocab["Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"];
  vocab["Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"] = vocab["Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"];
  vocab["Ù„Ù„Ø¨Ø­Ø±"] = vocab["Ø§Ù„Ø¨Ø­Ø±"];
  vocab["ÙˆÙ„Ù„Ø¨Ø­Ø±"] = vocab["Ø§Ù„Ø¨Ø­Ø±"];
  vocab["Ù„Ù„Ù…Ø§Ø¹Ø²"] = vocab["Ø§Ù„Ù…Ø§Ø¹Ø²"];
  vocab["ÙˆÙ„Ù„Ù…Ø§Ø¹Ø²"] = vocab["Ø§Ù„Ù…Ø§Ø¹Ø²"];
  vocab["Ù„Ù„Ø·Ø¨ÙŠØ¹Ø©"] = vocab["Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©"];
  vocab["ÙˆÙ„Ù„Ø·Ø¨ÙŠØ¹Ø©"] = vocab["Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©"];
  vocab["Ù„Ù„Ø±Ù‚Øµ"] = vocab["Ø§Ù„Ø±Ù‚Øµ"];
  vocab["ÙˆÙ„Ù„Ø±Ù‚Øµ"] = vocab["Ø§Ù„Ø±Ù‚Øµ"];
  vocab["Ù„Ù„Ø¹Ø¨"] = vocab["Ø§Ù„Ù„Ø¹Ø¨"];
  vocab["ÙˆÙ„Ù„Ø¹Ø¨"] = vocab["Ø§Ù„Ù„Ø¹Ø¨"];
  vocab["Ø§Ù„Ù‚Ø±ÙŠØ©"] = vocab["Ù‚Ø±ÙŠØ©"];
  vocab["Ù„Ù„Ù‚Ø±ÙŠØ©"] = vocab["Ù‚Ø±ÙŠØ©"];
  vocab["ÙˆÙ„Ù„Ù‚Ø±ÙŠØ©"] = vocab["Ù‚Ø±ÙŠØ©"];
  vocab["Ø¨Ø§Ù„Ø´Ø§Ø·Ø¦"] = vocab["Ø§Ù„Ø´Ø§Ø·Ø¦"];
  vocab["Ø§Ù„Ø´Ø§Ø·ÙŠØ¡"] = vocab["Ø§Ù„Ø´Ø§Ø·Ø¦"];

  const textContainer = document.getElementById("textContainer");
  const infoContent = document.getElementById("infoContent");
  let popup = null;

  function stripPunctuation(t) { return t.replace(/[.,!?ØŒØ›"Â«Â»()ØŸ]/g, ""); }

  function playAudio(url){
    if(!url) return;
    const a = new Audio(url);
    a.addEventListener("error", () => alert("Audio file not found:\n" + url));
    a.play().catch(() => alert("Browser blocked audio playback. Try clicking again."));
  }

  // âœ… FIX: phrase tokenization supports the leading Ùˆ (ÙˆØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ)
  function tokenizeWithPhrases(sentence) {
    const words = sentence.split(" ");
    const out = [];
    for (let i=0;i<words.length;i++){
      if (i < words.length - 1) {
        const first = stripPunctuation(words[i]);
        const second = stripPunctuation(words[i+1]);
        const two = first + " " + second;

        // Try removing leading Ùˆ from first word
        const twoWithoutWaw = (first.startsWith("Ùˆ") ? first.slice(1) : first) + " " + second;

        if (PHRASES.includes(two)) {
          out.push({ raw: words[i] + " " + words[i+1], key: two, isPhrase: true });
          i++; continue;
        }
        if (PHRASES.includes(twoWithoutWaw)) {
          out.push({ raw: words[i] + " " + words[i+1], key: twoWithoutWaw, isPhrase: true });
          i++; continue;
        }
      }
      out.push({ raw: words[i], key: null, isPhrase: false });
    }
    return out;
  }

  function normalizeKey(word) {
    const clean = stripPunctuation(word).replace(/Ù€/g,"");
    if (vocab[clean]) return clean;

    const multiPrefixes = ["ÙˆØ§Ù„","ÙØ§Ù„","Ø¨Ø§Ù„","ÙƒØ§Ù„","Ù„Ù„"];
    for (const mp of multiPrefixes){
      if (clean.startsWith(mp) && clean.length > mp.length + 1){
        const w = clean.slice(mp.length);
        if (vocab[w]) return w;
        if (vocab["Ø§Ù„"+w]) return "Ø§Ù„"+w;
      }
    }
    const single = ["Ùˆ","Ù","Ø¨","Ù„","Ùƒ"];
    let temp = clean;
    for (let i=0;i<3;i++){
      if (single.includes(temp[0]) && temp.length > 2){
        temp = temp.slice(1);
        if (vocab[temp]) return temp;
        if (vocab["Ø§Ù„"+temp]) return "Ø§Ù„"+temp;
      }
    }
    return clean;
  }

  // Render passage
  textParagraphs.forEach(par => {
    const p = document.createElement("p");
    p.className = "paragraph";

    const tokens = tokenizeWithPhrases(par);
    tokens.forEach((tok, i) => {
      const span = document.createElement("span");
      span.textContent = tok.raw;
      span.className = "word";

      const key = tok.isPhrase ? tok.key : normalizeKey(tok.raw);
      if (vocab[key]) {
        span.dataset.key = key;
        span.classList.add("has-vocab");
        if (vocab[key].type === "verb") span.classList.add("verb-word");
      }

      p.appendChild(span);
      if (i !== tokens.length - 1) p.appendChild(document.createTextNode(" "));
    });

    textContainer.appendChild(p);
  });

  textContainer.addEventListener("click", (e) => {
    const key = e.target.dataset.key;
    if (!key) return;
    const entry = vocab[key];
    showInfo(entry);
    showPopup(entry, e.target);
  });

  function showInfo(entry){
    infoContent.innerHTML = `
      <div class="info-word">${entry.base || ""}</div>
      <div class="transliteration">${entry.transliteration || ""}</div>

      <div class="definition-card">
        <div class="definition-label">Meaning (English):</div>
        <div class="definition-value">${entry.meaning || "â€”"}</div>
      </div>

      <div class="info-label" style="margin-top:10px;">Letters:</div>
      <div class="info-value">${entry.letters || "â€”"}</div>

      ${entry.image ? `
        <div class="image-card">
          <img src="${entry.image}" class="word-image" alt="">
        </div>` : ""}

      ${entry.audio ? `<div class="speak-btn" id="infoSpeakBtn">ğŸ”Š Listen</div>`
                   : `<div class="speak-btn" aria-disabled="true">ğŸ”Š (no audio)</div>`}
    `;

    const btn = document.getElementById("infoSpeakBtn");
    if (btn) btn.addEventListener("click", () => playAudio(entry.audio));
  }

  function showPopup(entry, anchor){
    if (popup) popup.remove();

    popup = document.createElement("div");
    popup.className = "popup-card";

    const speakBtnHtml = entry.audio
      ? `<div class="speak-btn" id="popSpeakBtn">ğŸ”Š Listen</div>`
      : `<div class="speak-btn" aria-disabled="true">ğŸ”Š (no audio)</div>`;

    popup.innerHTML = `
      <div class="info-word" style="margin-bottom:6px;">${entry.base || ""}</div>
      <div class="transliteration" style="margin-bottom:6px;">${entry.transliteration || ""}</div>

      <div class="definition-card" style="margin-top:6px;">
        <div class="definition-label">Meaning (English):</div>
        <div class="definition-value">${entry.meaning || "â€”"}</div>
      </div>

      ${entry.image ? `<img src="${entry.image}" class="popup-image" alt="">` : ""}
      ${speakBtnHtml}

      <div class="info-label" style="margin-top:8px;">Letters:</div>
      <div class="info-value">${entry.letters || "â€”"}</div>
    `;

    document.body.appendChild(popup);

    const rect = anchor.getBoundingClientRect();
    const popRect = popup.getBoundingClientRect();

    let top = rect.top + window.scrollY - popRect.height - 12;
    let left = rect.left + window.scrollX;

    if (top < 0) top = rect.bottom + window.scrollY + 12;

    const maxLeft = window.scrollX + document.documentElement.clientWidth - popRect.width - 12;
    if (left > maxLeft) left = maxLeft;
    if (left < 12) left = 12;

    popup.style.top = top + "px";
    popup.style.left = left + "px";

    const btn = document.getElementById("popSpeakBtn");
    if (btn) btn.addEventListener("click", () => playAudio(entry.audio));

    setTimeout(() => document.addEventListener("click", outsideClickClose), 0);
  }

  function outsideClickClose(ev){
    if (!popup) return;
    const clickedInsidePopup = popup.contains(ev.target);
    const clickedWord = ev.target.classList && ev.target.classList.contains("word");
    if (!clickedInsidePopup && !clickedWord) {
      popup.remove();
      popup = null;
      document.removeEventListener("click", outsideClickClose);
    }
  }

});
</script>
</body>
</html>
